<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="theme-color" content="#0b1020" />
<title>JÃ‹F âˆ â€” Recruteur</title>

<style>
:root{--bg:#020617;--bg2:#0b1020;--card:#0b1220;--line:rgba(148,163,184,.28);--ink:#f9fafb;--muted:#cbd5e1;--gold:#facc15;--green:#22c55e;--danger:#ef4444;--radius:18px;--tap:52px}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;font-size:18px;font-weight:800;
background:radial-gradient(900px 520px at 12% -10%, rgba(250,204,21,.16), transparent 60%),
radial-gradient(900px 520px at 90% 0%, rgba(34,197,94,.12), transparent 60%),
linear-gradient(180deg, var(--bg2), var(--bg));-webkit-font-smoothing:antialiased}
.wrap{width:100%;max-width:520px;margin:0 auto;padding:14px}
.top{border:1px solid var(--line);background:rgba(255,255,255,.03);border-radius:var(--radius);padding:14px}
h1{margin:0;font-size:clamp(22px,6vw,28px);font-weight:1000}
.sub{margin-top:8px;color:var(--muted);font-weight:850;line-height:1.35;font-size:16px}
.navRow{display:flex;gap:10px;margin-top:12px}
.btn{width:100%;min-height:var(--tap);border-radius:16px;border:1px solid rgba(148,163,184,.28);background:rgba(255,255,255,.03);color:var(--ink);
font-size:18px;font-weight:1000;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:10px}
.btn:active{transform:scale(.99)}
.btn.primary{background:var(--green);border-color:rgba(34,197,94,.25);color:#022c22}
.btn.gold{background:rgba(250,204,21,.14);border-color:rgba(250,204,21,.35);color:#fde68a}
.btn.ghost{background:rgba(255,255,255,.02)}
.card{margin-top:12px;border:1px solid var(--line);background:rgba(255,255,255,.03);border-radius:var(--radius);overflow:hidden}
.cardHead{padding:14px;border-bottom:1px solid var(--line);font-weight:1000}
.cardBody{padding:14px}
label{display:block;margin:12px 0 8px;font-size:16px;font-weight:1000;color:#fff}
input,select,textarea{width:100%;min-height:var(--tap);padding:14px 14px;border-radius:16px;border:1px solid rgba(148,163,184,.28);
background:rgba(0,0,0,.18);color:var(--ink);font-size:18px;font-weight:900;outline:none}
textarea{min-height:140px;resize:vertical}
input:focus,select:focus,textarea:focus{border-color:var(--gold);box-shadow:0 0 0 3px rgba(250,204,21,.15)}
.hint{display:block;margin-top:8px;color:var(--muted);font-size:15px;font-weight:850;line-height:1.35}
.note{display:none;margin-top:10px;padding:12px;border-radius:16px;border:1px solid rgba(148,163,184,.25);background:rgba(255,255,255,.02);color:var(--muted);white-space:pre-wrap}
.note.ok{display:block;border-color:rgba(34,197,94,.35);color:#bbf7d0;background:rgba(34,197,94,.09)}
.note.bad{display:block;border-color:rgba(239,68,68,.35);color:#fecaca;background:rgba(239,68,68,.09)}
.list{display:flex;flex-direction:column;gap:10px;margin-top:10px}
.item{border:1px solid rgba(148,163,184,.22);background:rgba(255,255,255,.02);border-radius:16px;padding:12px}
.itemTitle{font-weight:1000;font-size:18px}
.itemMeta{color:var(--muted);font-weight:850;font-size:15px;margin-top:4px;line-height:1.3}
hr{border:none;border-top:1px solid rgba(148,163,184,.18);margin:12px 0}
</style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <h1>ğŸª JÃ‹F âˆ â€” Recruteur</h1>
    <div class="sub">Publie une demande dâ€™apprenti. Les jeunes te contactent direct.</div>

    <div class="navRow">
      <button class="btn ghost" id="back">â¬…ï¸ Retour</button>
      <button class="btn gold" id="seeAll">ğŸ” Voir annonces</button>
    </div>
  </div>

  <div class="card">
    <div class="cardHead">Ton annonce (simple et claire)</div>
    <div class="cardBody">
      <label>Nom atelier / commerce *</label>
      <input id="business_name" placeholder="ex: Atelier Ndiaye" maxlength="80"/>

      <label>MÃ©tier recherchÃ© *</label>
      <select id="trade">
        <option value="">â€” Choisir â€”</option>
        <option>Plomberie</option>
        <option>Ã‰lectricitÃ©</option>
        <option>MÃ©canique</option>
        <option>Vente</option>
        <option>MÃ©tier de bouche</option>
      </select>

      <label>Type *</label>
      <select id="offer_type">
        <option value="apprentissage">Apprentissage</option>
        <option value="stage">Stage</option>
        <option value="aide">Aide / renfort</option>
      </select>

      <label>Ville *</label>
      <input id="city" placeholder="ex: Dakar, Saly, ThiÃ¨s" maxlength="40"/>

      <label>Zone / Quartier (optionnel)</label>
      <input id="area" placeholder="ex: MÃ©dina, Keur Massar, Ngaparou" maxlength="60"/>

      <label>Ton WhatsApp / tÃ©lÃ©phone *</label>
      <input id="whatsapp" placeholder="+221 77 123 45 67" maxlength="20"/>

      <label>Description (2â€“5 lignes)</label>
      <textarea id="description" placeholder="ex: On cherche un jeune motivÃ©. Horaire 9h-18h. Apprentissage sÃ©rieux." maxlength="500"></textarea>

      <div style="margin-top:12px;display:flex;flex-direction:column;gap:10px">
        <button class="btn primary" id="save">âœ… Publier mon annonce</button>
        <button class="btn" id="clear">ğŸ§¹ Effacer le formulaire</button>
      </div>

      <div class="note" id="note"></div>
      <hr>
      <div class="hint">ğŸ“Œ V1 : stockage local. V2 : Supabase â†’ annonces visibles partout.</div>
    </div>
  </div>

  <div class="card">
    <div class="cardHead">Annonces enregistrÃ©es (sur ce tÃ©lÃ©phone)</div>
    <div class="cardBody">
      <div class="list" id="list"></div>
      <div class="hint" id="emptyHint">Aucune annonce pour lâ€™instant.</div>
    </div>
  </div>
</div>

<script>
(function(){
  "use strict";
  const KEY = "DIGIY_JEF_OFFERS_V1";
  const $ = (id)=> document.getElementById(id);

  const back = $("back");
  const seeAll = $("seeAll");
  const note = $("note");
  const list = $("list");
  const emptyHint = $("emptyHint");

  back.onclick = ()=> location.href = "./digiy-jef.html";
  seeAll.onclick = ()=> { window.scrollTo({top: document.body.scrollHeight, behavior:"smooth"}); };

  function showNote(msg, type){
    note.className = "note " + (type || "");
    note.textContent = msg;
  }
  function hideNote(){
    note.className = "note";
    note.textContent = "";
  }

  function load(){
    try{ return JSON.parse(localStorage.getItem(KEY) || "[]"); }
    catch(e){ return []; }
  }
  function saveAll(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); }

  function validPhone(v){
    const s = String(v||"").replace(/\s/g,"").trim();
    return s.length >= 9;
  }

  function escapeHtml(s){
    return String(s||"").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
  }

  function render(){
    list.innerHTML = "";
    const data = load();
    emptyHint.style.display = data.length ? "none" : "block";

    data.slice().reverse().forEach((o)=>{
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div class="itemTitle">${escapeHtml(o.trade)} â€¢ ${escapeHtml(o.offer_type)}</div>
        <div class="itemMeta">ğŸª ${escapeHtml(o.business_name)}</div>
        <div class="itemMeta">ğŸ“ ${escapeHtml(o.city)}${o.area ? " â€¢ " + escapeHtml(o.area) : ""}</div>
        <div class="itemMeta">ğŸ“ ${escapeHtml(o.whatsapp)}</div>
        <div class="itemMeta">${o.description ? "ğŸ“ " + escapeHtml(o.description) : ""}</div>
        <div style="margin-top:10px;display:flex;gap:10px">
          <button class="btn gold" data-wa="${encodeURIComponent(o.whatsapp)}">ğŸ’¬ WhatsApp</button>
          <button class="btn" data-del="${o.id}">ğŸ—‘ï¸ Supprimer</button>
        </div>
      `;
      list.appendChild(div);
    });

    list.querySelectorAll("[data-del]").forEach(btn=>{
      btn.onclick = ()=>{
        const id = btn.getAttribute("data-del");
        if(!confirm("Supprimer cette annonce ?")) return;
        const data = load().filter(x=> String(x.id)!==String(id));
        saveAll(data);
        render();
        showNote("âœ… Annonce supprimÃ©e.", "ok");
      };
    });

    list.querySelectorAll("[data-wa]").forEach(btn=>{
      btn.onclick = ()=>{
        const num = decodeURIComponent(btn.getAttribute("data-wa")||"");
        const clean = num.replace(/\s/g,"");
        const url = "https://wa.me/" + clean.replace(/^\+/, "");
        window.open(url, "_blank", "noopener");
      };
    });
  }

  $("clear").onclick = ()=>{
    ["business_name","trade","offer_type","city","area","whatsapp","description"].forEach(id=>{
      const el = $(id);
      if(el.tagName==="SELECT"){
        if(id==="offer_type") el.value="apprentissage";
        else el.value="";
      } else el.value="";
    });
    hideNote();
  };

  $("save").onclick = ()=>{
    hideNote();
    const payload = {
      id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now()),
      business_name: $("business_name").value.trim(),
      trade: $("trade").value.trim(),
      offer_type: $("offer_type").value,
      city: $("city").value.trim(),
      area: $("area").value.trim(),
      whatsapp: $("whatsapp").value.trim(),
      description: $("description").value.trim(),
    };

    const errors = [];
    if(payload.business_name.length < 2) errors.push("âŒ Mets le nom du commerce/atelier (au moins 2 lettres).");
    if(!payload.trade) errors.push("âŒ Choisis un mÃ©tier.");
    if(payload.city.length < 2) errors.push("âŒ Mets la ville.");
    if(!validPhone(payload.whatsapp)) errors.push("âŒ Mets un numÃ©ro WhatsApp/tel valide.");

    if(errors.length) return showNote(errors.join("\n"), "bad");

    const data = load();
    data.push(payload);
    localStorage.setItem(KEY, JSON.stringify(data));
    render();
    showNote("âœ… Annonce publiÃ©e sur ce tÃ©lÃ©phone. (V2 Supabase = visible partout)", "ok");
  };

  render();
})();
</script>
</body>
</html>
