<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>DIGIY ‚ôæÔ∏è ‚Äî DRIVE</title>
  <meta name="theme-color" content="#16a34a"/>
  <meta name="description" content="DIGIY DRIVE ‚Äî orientation rapide vers les modules. NDIMBAL, Travail, Pay, Jobs, etc." />

  <style>
    :root{
      --green:#16a34a;
      --bg:#061b14;
      --card:#0b2a1f;
      --line:rgba(255,255,255,.14);
      --text:#eafff1;
      --muted:rgba(234,255,241,.78);
      --dark:#052e16;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:radial-gradient(900px 500px at 10% -10%, rgba(34,197,94,.20), transparent 60%), var(--bg);
      color:var(--text);
      display:flex;flex-direction:column;
    }
    header{
      padding:18px 16px 10px;
      text-align:center;
      border-bottom:1px solid var(--line);
      background:rgba(6,27,20,.72);
      backdrop-filter:blur(10px);
    }
    .brand{
      font-weight:950;letter-spacing:.12em;font-size:18px;
      display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap;
    }
    .brand .badge{
      display:inline-flex;align-items:center;justify-content:center;
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.18);
      font-weight:950;font-size:12px;letter-spacing:.06em;
    }
    .subtitle{margin-top:8px;font-weight:800;color:var(--muted);font-size:13px;}
    main{
      flex:1;
      padding:14px;
      max-width:560px;
      margin:0 auto;
      width:100%;
      display:flex;flex-direction:column;gap:12px;
    }
    .card{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:14px;
      box-shadow:0 18px 40px rgba(0,0,0,.18);
    }
    .btn{
      width:100%;
      padding:18px 16px;
      border:none;
      border-radius:var(--radius);
      background:var(--card);
      border:1px solid var(--line);
      color:var(--text);
      text-align:left;
      font-weight:950;
      font-size:16px;
      cursor:pointer;
    }
    .btn span{
      display:block;
      margin-top:6px;
      font-size:13px;
      font-weight:800;
      color:var(--muted);
      line-height:1.25;
    }
    .btn.primary{
      background:linear-gradient(135deg,#16a34a,#22c55e);
      color:var(--dark);
      border:none;
    }
    .btn.primary span{color:var(--dark);opacity:.85;}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    @media(max-width:560px){
      .grid2{grid-template-columns:1fr;}
      header{backdrop-filter:none;}
    }
    .mini{padding:14px 14px;font-size:15px;}
    .pillrow{
      display:flex;gap:8px;flex-wrap:wrap;
      justify-content:center;margin-top:10px;
    }
    .pill{
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(0,0,0,.14);
      font-weight:900;font-size:12px;
      color:rgba(234,255,241,.86);
    }
    footer{
      text-align:center;
      padding:14px 10px;
      font-size:12px;
      font-weight:800;
      color:rgba(234,255,241,.72);
      border-top:1px solid rgba(255,255,255,.10);
      background:rgba(6,27,20,.55);
    }
    a{color:#86efac;text-decoration:none;font-weight:950}
    .footrow{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
  </style>

  <!-- ‚úÖ Supabase SDK (une seule fois) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    /* =========================================================
      DIGIY ‚Äî SUPABASE SINGLETON (ANTI "already declared")
      -> on stocke le client dans window.DIGIY_SB
    ========================================================= */
    (function(){
      const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

      // üëá jamais "const supabase = ..." (√ßa casse d√®s qu‚Äôon recolle 2 fois)
      if(!window.DIGIY_SB){
        window.DIGIY_SB = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      }
    })();
  </script>

  <script>
    /* =========================================================
      DIGIY ‚Äî GUARD UNIVERSEL (optionnel)
      - si pas connect√© -> reste sur DRIVE (ou tu peux rediriger plus tard)
    ========================================================= */
    async function digiyGuard(rules = {}){
      try{
        const sb = window.DIGIY_SB;
        if(!sb) return { user:null, profile:null };

        const { data: sessionData } = await sb.auth.getSession();
        const user = sessionData?.session?.user;
        if(!user){
          // Ici on laisse sur DRIVE (pas de 404 / pas de boucle)
          return { user:null, profile:null };
        }

        const { data: profile } = await sb
          .from("profiles")
          .select("id, role_auto, pro_type, active_modules")
          .eq("id", user.id)
          .single();

        if(!profile) return { user, profile:null };

        const roleOK = !rules.role_auto || (Array.isArray(rules.role_auto) && rules.role_auto.includes(profile.role_auto));
        const proOK  = !rules.pro_type  || (Array.isArray(rules.pro_type)  && rules.pro_type.includes(profile.pro_type));

        if(!roleOK || !proOK){
          return { user, profile };
        }

        return { user, profile };
      }catch(e){
        console.warn("digiyGuard:", e);
        return { user:null, profile:null };
      }
    }
    // digiyGuard(); // si tu veux activer partout
  </script>
</head>

<body>
<header>
  <div class="brand">
    ‚ôæÔ∏è DIGIY <span class="badge">DRIVE</span>
  </div>
  <div class="subtitle">Des solutions simples pour avancer ‚Äî orientation rapide (terrain)</div>
  <div class="pillrow">
    <div class="pill">Mobile-first</div>
    <div class="pill">0% commission</div>
    <div class="pill">Direct au peuple</div>
  </div>
</header>

<main>

  <div class="card">
    <button class="btn primary" onclick="go('ndimbal')">
      ‚ôæÔ∏è NDIMBAL
      <span>Besoin d‚Äôaide, mission rapide, entraide ‚Äî lecture ultra rapide</span>
    </button>

    <div style="height:10px"></div>

    <button class="btn" onclick="go('jobs')">
      üíº Trouver du travail
      <span>Voir les missions disponibles (plus r√©cent en haut)</span>
    </button>
  </div>

  <div class="grid2">
    <button class="btn mini" onclick="go('pay')">
      üí≥ Payer / Recevoir
      <span>Argent, services, transactions</span>
    </button>

    <button class="btn mini" onclick="go('transport')">
      üöó Transport
      <span>Se d√©placer, livrer</span>
    </button>
  </div>

  <div class="card">
    <div style="font-weight:950;letter-spacing:.06em;margin-bottom:10px;">Acc√®s directs</div>

    <div class="grid2">
      <button class="btn mini" onclick="openPath('/digiy-jef.html')">
        ‚ôæÔ∏è J√ãF (complet)
        <span>Version compl√®te</span>
      </button>

      <button class="btn mini" onclick="openPath('/publish-mission.htm')">
        ‚ûï Publier mission
        <span>Cr√©er une annonce</span>
      </button>

      <button class="btn mini" onclick="openPath('/digiy-jobs.html')">
        üßëüèæ‚Äçüíº JOBS PRO
        <span>Recrutement structur√©</span>
      </button>

      <button class="btn mini" onclick="openPath('/digiy-pay.html')">
        üí≥ DIGIY PAY
        <span>Paiements & outils</span>
      </button>
    </div>
  </div>

</main>

<footer>
  <div class="footrow">
    <!-- ‚úÖ RETOUR = vitrine DIGIY HUB (pas atelier) -->
    <a href="https://beauville.github.io/digiy-hub/">‚Üê Retour vitrine DIGIY HUB</a>
    <span style="opacity:.55">‚Ä¢</span>
    <a href="https://beauville.github.io/digiy-hub-drive/">Accueil DRIVE</a>
  </div>
</footer>

<script>
/* =========================
   DIGIY HUB DRIVE ‚Äî GitHub Pages
========================= */
const BASE = "/digiy-hub-drive";

function openPath(path){
  location.href = BASE + path;
}

function go(target){
  try{
    localStorage.setItem("digiy_intent", JSON.stringify({ from:"HUB_DRIVE", action:target, ts:Date.now() }));
  }catch(e){}

  switch(target){
    case "ndimbal":
    case "jobs":
      location.href = BASE + "/digiy-jef-lite.html";
      break;

    case "pay":
      location.href = BASE + "/digiy-pay.html";
      break;

    case "transport":
      alert("Transport bient√¥t disponible");
      break;

    default:
      alert("Module indisponible pour le moment");
  }
}
</script>

</body>
</html>
