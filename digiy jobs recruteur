<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>DIGIY ‚ôæÔ∏è JOBS ‚Äî Recruteur</title>
  <meta name="theme-color" content="#16a34a"/>
  <meta name="description" content="Publiez vos offres d'emploi sur DIGIY JOBS ‚Äî 0% commission"/>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --green:#16a34a; --green2:#22c55e;
      --bg:#061b14; --card:#0b2a1f; --line:rgba(255,255,255,.14);
      --text:#eafff1; --muted:rgba(234,255,241,.78); --dark:#052e16;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background: radial-gradient(900px 500px at 10% -10%, rgba(34,197,94,.20), transparent 60%), var(--bg);
      color:var(--text);
    }
    header{
      padding:18px 16px 12px;
      border-bottom:1px solid var(--line);
      background:rgba(6,27,20,.72);
      text-align:center;
    }
    .brand{
      font-weight:950;
      letter-spacing:.12em;
      font-size:18px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .badge{
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      font-weight:950;
      font-size:12px;
    }
    .subtitle{
      margin-top:8px;
      font-weight:800;
      color:var(--muted);
      font-size:13px;
    }
    main{
      max-width:680px;
      margin:0 auto;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .info-box{
      background:#ecfdf5;
      color:#065f46;
      border:1px solid #bbf7d0;
      border-radius:14px;
      padding:14px;
      font-size:14px;
      font-weight:800;
      line-height:1.5;
    }
    .progress-container{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px;
      margin-bottom:8px;
    }
    .progress-bar{
      width:100%;
      height:8px;
      background:rgba(0,0,0,.3);
      border-radius:999px;
      overflow:hidden;
    }
    .progress-fill{
      height:100%;
      background:linear-gradient(90deg,var(--green),var(--green2));
      transition:width .3s ease;
      width:0%;
    }
    .progress-text{
      margin-top:8px;
      font-size:12px;
      font-weight:800;
      color:var(--muted);
      text-align:center;
    }
    .card{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:16px;
    }
    .card-title{
      font-weight:950;
      margin-bottom:12px;
      font-size:16px;
    }
    label{
      display:block;
      font-weight:900;
      margin:14px 0 6px;
      font-size:14px;
    }
    input, textarea, select{
      width:100%;
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#052e16;
      color:var(--text);
      font-weight:800;
      font-size:14px;
      outline:none;
      transition:border-color .2s;
    }
    input:focus, textarea:focus, select:focus{
      border-color:var(--green);
    }
    input.error, textarea.error, select.error{
      border-color:#f87171;
    }
    select{
      cursor:pointer;
    }
    textarea{
      resize:vertical;
      min-height:80px;
      line-height:1.5;
    }
    .input-group{
      position:relative;
    }
    .char-counter{
      position:absolute;
      right:12px;
      bottom:8px;
      font-size:11px;
      color:var(--muted);
      font-weight:800;
    }
    .autocomplete-suggestions{
      position:absolute;
      top:100%;
      left:0;
      right:0;
      background:#052e16;
      border:1px solid var(--line);
      border-radius:14px;
      margin-top:4px;
      max-height:200px;
      overflow-y:auto;
      z-index:100;
      display:none;
    }
    .autocomplete-suggestions.active{
      display:block;
    }
    .suggestion-item{
      padding:10px 12px;
      cursor:pointer;
      font-size:14px;
      font-weight:800;
      transition:background .2s;
    }
    .suggestion-item:hover{
      background:rgba(22,163,74,.2);
    }
    .btn{
      width:100%;
      padding:16px;
      border:none;
      border-radius:16px;
      background:linear-gradient(135deg,var(--green),var(--green2));
      color:var(--dark);
      font-weight:950;
      font-size:16px;
      cursor:pointer;
      margin-top:12px;
      transition:opacity .2s, transform .1s;
    }
    .btn:hover:not(:disabled){
      transform:translateY(-2px);
    }
    .btn:active:not(:disabled){
      transform:translateY(0);
    }
    .btn:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    .btn.ghost{
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      color:var(--text);
    }
    .btn.secondary{
      background:rgba(34,197,94,.15);
      color:var(--green2);
      font-size:14px;
      padding:10px;
      margin-top:8px;
    }
    .note{
      font-size:13px;
      color:var(--muted);
      margin-top:8px;
      font-weight:800;
    }
    .required{
      color:#f87171;
    }
    .draft-banner{
      background:rgba(251,191,36,.15);
      border:1px solid rgba(251,191,36,.4);
      border-radius:14px;
      padding:12px;
      margin-bottom:12px;
      display:none;
    }
    .draft-banner.active{
      display:block;
    }
    .draft-banner strong{
      color:#fbbf24;
    }
    .draft-actions{
      margin-top:8px;
      display:flex;
      gap:8px;
    }
    .draft-actions button{
      flex:1;
      padding:8px;
      border-radius:10px;
      border:none;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
    }
    .draft-load{
      background:var(--green);
      color:var(--dark);
    }
    .draft-delete{
      background:rgba(255,255,255,.1);
      color:var(--text);
    }
    
    /* MODAL */
    .modal-overlay{
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      background:rgba(0,0,0,.85);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:1000;
      padding:20px;
    }
    .modal-overlay.active{
      display:flex;
    }
    .modal{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      max-width:500px;
      width:100%;
      max-height:90vh;
      overflow-y:auto;
      padding:20px;
    }
    .modal-header{
      font-weight:950;
      font-size:18px;
      margin-bottom:16px;
      text-align:center;
    }
    .modal-body{
      margin-bottom:16px;
    }
    .preview-field{
      margin-bottom:12px;
      padding-bottom:12px;
      border-bottom:1px solid var(--line);
    }
    .preview-field:last-child{
      border:none;
    }
    .preview-label{
      font-size:12px;
      color:var(--muted);
      font-weight:800;
      margin-bottom:4px;
    }
    .preview-value{
      font-weight:900;
      font-size:14px;
    }
    .modal-actions{
      display:flex;
      gap:10px;
    }
    .modal-actions button{
      flex:1;
      padding:14px;
      border:none;
      border-radius:14px;
      font-weight:950;
      cursor:pointer;
    }
    .modal-confirm{
      background:linear-gradient(135deg,var(--green),var(--green2));
      color:var(--dark);
    }
    .modal-cancel{
      background:rgba(255,255,255,.08);
      color:var(--text);
    }
    
    footer{
      text-align:center;
      padding:16px 10px;
      font-size:12px;
      font-weight:800;
      color:rgba(234,255,241,.72);
      border-top:1px solid rgba(255,255,255,.10);
      background:rgba(6,27,20,.55);
    }
    a{
      color:#86efac;
      text-decoration:none;
      font-weight:950;
    }
    
    @media(max-width:600px){
      .modal{
        padding:16px;
      }
      .draft-actions{
        flex-direction:column;
      }
    }
  </style>
</head>

<body>

<header>
  <div class="brand">
    ‚ôæÔ∏è DIGIY <span class="badge">JOBS RECRUTEUR</span>
  </div>
  <div class="subtitle">Publiez vos offres d'emploi ‚Äî 0% commission</div>
</header>

<main>

  <div class="info-box">
    <strong>üíº Comment √ßa marche ?</strong><br>
    1Ô∏è‚É£ Vous publiez votre offre d'emploi gratuitement<br>
    2Ô∏è‚É£ L'√©quipe DIGIY valide votre offre (anti-spam)<br>
    3Ô∏è‚É£ Les candidats vous contactent directement<br>
    <strong>0% commission ‚Ä¢ Contact direct ‚Ä¢ Simplicit√©</strong>
  </div>

  <!-- DRAFT BANNER -->
  <div class="draft-banner" id="draftBanner">
    <strong>üìù Brouillon sauvegard√© d√©tect√©</strong>
    <div class="note" style="margin-top:4px">Voulez-vous reprendre l√† o√π vous vous √™tes arr√™t√© ?</div>
    <div class="draft-actions">
      <button class="draft-load" onclick="loadDraft()">‚úÖ Reprendre</button>
      <button class="draft-delete" onclick="deleteDraft()">üóëÔ∏è Supprimer</button>
    </div>
  </div>

  <!-- PROGRESS BAR -->
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-text">Formulaire compl√©t√© : <span id="progressPercent">0</span>%</div>
  </div>

  <div class="card">
    <div class="card-title">üìã Informations entreprise</div>

    <label>Nom de l'entreprise <span class="required">*</span></label>
    <input id="company_name" placeholder="Ex: DIGIYLYFE SARL" oninput="updateProgress(); saveDraft()"/>

    <label>Votre nom (recruteur)</label>
    <input id="recruiter_name" placeholder="Ex: Amadou Diallo" oninput="saveDraft()"/>

    <label>T√©l√©phone (WhatsApp) <span class="required">*</span></label>
    <input id="recruiter_phone" type="tel" placeholder="+221771234567" oninput="updateProgress(); saveDraft()"/>
    <button class="btn secondary" onclick="formatPhoneNumber()">üì± Auto-formater num√©ro</button>

    <label>Email (optionnel)</label>
    <input id="recruiter_email" type="email" placeholder="contact@entreprise.sn" oninput="saveDraft()"/>
  </div>

  <div class="card">
    <div class="card-title">üíº D√©tails du poste</div>

    <label>Titre du poste <span class="required">*</span></label>
    <input id="job_title" placeholder="Ex: D√©veloppeur Web Full-Stack" oninput="updateProgress(); saveDraft()"/>

    <label>Type de contrat <span class="required">*</span></label>
    <select id="job_type" onchange="updateProgress(); saveDraft()">
      <option value="">-- S√©lectionner --</option>
      <option value="CDI">CDI</option>
      <option value="CDD">CDD</option>
      <option value="Stage">Stage</option>
      <option value="Freelance">Freelance</option>
      <option value="Int√©rim">Int√©rim</option>
      <option value="Alternance">Alternance</option>
    </select>

    <label>Localisation <span class="required">*</span></label>
    <div class="input-group" style="position:relative">
      <input id="location" placeholder="Ex: Dakar, Plateau" oninput="updateProgress(); saveDraft(); showLocationSuggestions(this.value)" autocomplete="off"/>
      <div class="autocomplete-suggestions" id="locationSuggestions"></div>
    </div>

    <label>Fourchette salariale (optionnel)</label>
    <input id="salary_range" placeholder="Ex: 300 000 - 500 000 FCFA/mois" oninput="saveDraft()"/>

    <label>Description du poste <span class="required">*</span></label>
    <div class="input-group">
      <textarea id="description" rows="5" placeholder="D√©crivez les missions, responsabilit√©s, environnement de travail..." oninput="updateProgress(); saveDraft(); updateCharCount('description', 500)"></textarea>
      <div class="char-counter" id="descriptionCounter">0/500</div>
    </div>

    <label>Profil recherch√© / Comp√©tences requises</label>
    <div class="input-group">
      <textarea id="requirements" rows="4" placeholder="Ex: Bac+3, 2 ans d'exp√©rience, ma√Ætrise de React/Node.js..." oninput="saveDraft(); updateCharCount('requirements', 400)"></textarea>
      <div class="char-counter" id="requirementsCounter">0/400</div>
    </div>
  </div>

  <div class="card">
    <button class="btn" id="btnSubmit" onclick="previewOffer()">
      üëÅÔ∏è Pr√©visualiser l'offre
    </button>
    <div class="note">
      ‚ö†Ô∏è Tous les champs marqu√©s <span class="required">*</span> sont obligatoires.<br>
      üíæ Votre brouillon est sauvegard√© automatiquement.
    </div>

    <button class="btn ghost" onclick="location.href='index.html'" style="margin-top:10px">
      ‚Üê Retour au HUB
    </button>
  </div>

</main>

<footer>
  DIGIYLYFE ‚ôæÔ∏è ‚Äî direct au peuple ‚Ä¢ 0% commission ‚Ä¢
  <a href="index.html">Retour HUB</a>
</footer>

<!-- PREVIEW MODAL -->
<div class="modal-overlay" id="previewModal">
  <div class="modal">
    <div class="modal-header">üëÅÔ∏è Aper√ßu de votre offre</div>
    <div class="modal-body" id="previewContent"></div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closePreview()">‚úèÔ∏è Modifier</button>
      <button class="modal-confirm" onclick="submitOffer()">üì§ Publier</button>
    </div>
  </div>
</div>

<script>
/* =========================
   SUPABASE
========================= */
const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY =
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA";

const SB = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

/* =========================
   LOCATIONS SENEGAL
========================= */
const LOCATIONS = [
  "Dakar - Plateau",
  "Dakar - Almadies",
  "Dakar - Mermoz",
  "Dakar - Sacr√©-C≈ìur",
  "Dakar - Point E",
  "Dakar - Ouakam",
  "Dakar - Ngor",
  "Dakar - Yoff",
  "Dakar - Parcelles Assainies",
  "Dakar - Grand Yoff",
  "Pikine",
  "Gu√©diawaye",
  "Rufisque",
  "Thi√®s",
  "Saint-Louis",
  "Mbour",
  "Kaolack",
  "Ziguinchor",
  "Louga",
  "Tambacounda",
  "Kolda",
  "Diourbel",
  "S√©dhiou",
  "Matam",
  "Kaffrine"
];

/* =========================
   DRAFT MANAGEMENT
========================= */
function saveDraft(){
  const draft = {
    company_name: document.getElementById("company_name").value,
    recruiter_name: document.getElementById("recruiter_name").value,
    recruiter_phone: document.getElementById("recruiter_phone").value,
    recruiter_email: document.getElementById("recruiter_email").value,
    job_title: document.getElementById("job_title").value,
    job_type: document.getElementById("job_type").value,
    location: document.getElementById("location").value,
    salary_range: document.getElementById("salary_range").value,
    description: document.getElementById("description").value,
    requirements: document.getElementById("requirements").value,
    timestamp: Date.now()
  };
  localStorage.setItem("digiy_job_draft", JSON.stringify(draft));
}

function loadDraft(){
  const draftStr = localStorage.getItem("digiy_job_draft");
  if(!draftStr) return;
  
  const draft = JSON.parse(draftStr);
  document.getElementById("company_name").value = draft.company_name || "";
  document.getElementById("recruiter_name").value = draft.recruiter_name || "";
  document.getElementById("recruiter_phone").value = draft.recruiter_phone || "";
  document.getElementById("recruiter_email").value = draft.recruiter_email || "";
  document.getElementById("job_title").value = draft.job_title || "";
  document.getElementById("job_type").value = draft.job_type || "";
  document.getElementById("location").value = draft.location || "";
  document.getElementById("salary_range").value = draft.salary_range || "";
  document.getElementById("description").value = draft.description || "";
  document.getElementById("requirements").value = draft.requirements || "";
  
  document.getElementById("draftBanner").classList.remove("active");
  updateProgress();
  updateCharCount("description", 500);
  updateCharCount("requirements", 400);
}

function deleteDraft(){
  localStorage.removeItem("digiy_job_draft");
  document.getElementById("draftBanner").classList.remove("active");
}

function checkDraft(){
  const draftStr = localStorage.getItem("digiy_job_draft");
  if(draftStr){
    const draft = JSON.parse(draftStr);
    // V√©rifier si le brouillon a du contenu
    if(draft.company_name || draft.job_title || draft.description){
      document.getElementById("draftBanner").classList.add("active");
    }
  }
}

/* =========================
   PROGRESS TRACKING
========================= */
function updateProgress(){
  const fields = [
    "company_name",
    "recruiter_phone",
    "job_title",
    "job_type",
    "location",
    "description"
  ];
  
  let filled = 0;
  fields.forEach(id => {
    const val = document.getElementById(id).value.trim();
    if(val) filled++;
  });
  
  const percent = Math.round((filled / fields.length) * 100);
  document.getElementById("progressFill").style.width = percent + "%";
  document.getElementById("progressPercent").textContent = percent;
}

/* =========================
   CHAR COUNTER
========================= */
function updateCharCount(fieldId, max){
  const field = document.getElementById(fieldId);
  const counter = document.getElementById(fieldId + "Counter");
  const len = field.value.length;
  counter.textContent = len + "/" + max;
  
  if(len > max){
    field.classList.add("error");
    counter.style.color = "#f87171";
  } else {
    field.classList.remove("error");
    counter.style.color = "var(--muted)";
  }
}

/* =========================
   LOCATION AUTOCOMPLETE
========================= */
function showLocationSuggestions(val){
  const container = document.getElementById("locationSuggestions");
  
  if(!val || val.length < 2){
    container.classList.remove("active");
    return;
  }
  
  const filtered = LOCATIONS.filter(loc => 
    loc.toLowerCase().includes(val.toLowerCase())
  );
  
  if(filtered.length === 0){
    container.classList.remove("active");
    return;
  }
  
  container.innerHTML = filtered.slice(0, 5).map(loc => 
    `<div class="suggestion-item" onclick="selectLocation('${loc}')">${loc}</div>`
  ).join("");
  
  container.classList.add("active");
}

function selectLocation(loc){
  document.getElementById("location").value = loc;
  document.getElementById("locationSuggestions").classList.remove("active");
  updateProgress();
  saveDraft();
}

// Fermer suggestions au clic ext√©rieur
document.addEventListener("click", (e) => {
  if(!e.target.closest(".input-group")){
    document.getElementById("locationSuggestions").classList.remove("active");
  }
});

/* =========================
   PHONE FORMATTING
========================= */
function formatPhoneNumber(){
  const input = document.getElementById("recruiter_phone");
  let phone = input.value.replace(/\D/g, "");
  
  // Retirer pr√©fixes
  if(phone.startsWith("221")) phone = phone.substring(3);
  if(phone.startsWith("00221")) phone = phone.substring(5);
  
  // V√©rifier format S√©n√©gal (7X XXXXXXX)
  if(phone.length === 9 && phone.startsWith("7")){
    input.value = "+221" + phone;
    input.classList.remove("error");
    saveDraft();
  } else {
    alert("‚ö†Ô∏è Format invalide. Num√©ro s√©n√©galais attendu (ex: 771234567)");
    input.classList.add("error");
  }
}

function validatePhone(phone){
  const clean = phone.replace(/\D/g, "");
  // +221 7X XXXXXXX
  const pattern = /^(\+221|00221)?(7[05678])\d{7}$/;
  return pattern.test(phone.replace(/\s/g, ""));
}

/* =========================
   PREVIEW MODAL
========================= */
function previewOffer(){
  // R√©cup√©ration
  const company_name = document.getElementById("company_name").value.trim();
  const recruiter_name = document.getElementById("recruiter_name").value.trim();
  const recruiter_phone = document.getElementById("recruiter_phone").value.trim();
  const recruiter_email = document.getElementById("recruiter_email").value.trim();
  const job_title = document.getElementById("job_title").value.trim();
  const job_type = document.getElementById("job_type").value;
  const location = document.getElementById("location").value.trim();
  const salary_range = document.getElementById("salary_range").value.trim();
  const description = document.getElementById("description").value.trim();
  const requirements = document.getElementById("requirements").value.trim();

  // Validation
  if(!company_name){
    alert("‚ö†Ô∏è Le nom de l'entreprise est obligatoire.");
    document.getElementById("company_name").focus();
    return;
  }
  if(!recruiter_phone){
    alert("‚ö†Ô∏è Le t√©l√©phone (WhatsApp) est obligatoire.");
    document.getElementById("recruiter_phone").focus();
    return;
  }
  if(!validatePhone(recruiter_phone)){
    alert("‚ö†Ô∏è Format t√©l√©phone invalide. Utilisez +221XXXXXXXXX");
    document.getElementById("recruiter_phone").classList.add("error");
    document.getElementById("recruiter_phone").focus();
    return;
  }
  if(!job_title || job_title.length < 5){
    alert("‚ö†Ô∏è Le titre du poste doit faire au moins 5 caract√®res.");
    document.getElementById("job_title").focus();
    return;
  }
  if(!job_type){
    alert("‚ö†Ô∏è S√©lectionnez un type de contrat.");
    document.getElementById("job_type").focus();
    return;
  }
  if(!location){
    alert("‚ö†Ô∏è La localisation est obligatoire.");
    document.getElementById("location").focus();
    return;
  }
  if(!description || description.length < 20){
    alert("‚ö†Ô∏è La description doit faire au moins 20 caract√®res.");
    document.getElementById("description").focus();
    return;
  }
  if(description.length > 500){
    alert("‚ö†Ô∏è La description ne peut pas d√©passer 500 caract√®res.");
    document.getElementById("description").focus();
    return;
  }
  if(requirements.length > 400){
    alert("‚ö†Ô∏è Les comp√©tences ne peuvent pas d√©passer 400 caract√®res.");
    document.getElementById("requirements").focus();
    return;
  }

  // Afficher preview
  const previewHTML = `
    <div class="preview-field">
      <div class="preview-label">üè¢ Entreprise</div>
      <div class="preview-value">${company_name}</div>
    </div>
    ${recruiter_name ? `
    <div class="preview-field">
      <div class="preview-label">üë§ Recruteur</div>
      <div class="preview-value">${recruiter_name}</div>
    </div>` : ''}
    <div class="preview-field">
      <div class="preview-label">üì± Contact WhatsApp</div>
      <div class="preview-value">${recruiter_phone}</div>
    </div>
    ${recruiter_email ? `
    <div class="preview-field">
      <div class="preview-label">üìß Email</div>
      <div class="preview-value">${recruiter_email}</div>
    </div>` : ''}
    <div class="preview-field">
      <div class="preview-label">üíº Poste</div>
      <div class="preview-value">${job_title}</div>
    </div>
    <div class="preview-field">
      <div class="preview-label">üìã Type de contrat</div>
      <div class="preview-value">${job_type}</div>
    </div>
    <div class="preview-field">
      <div class="preview-label">üìç Localisation</div>
      <div class="preview-value">${location}</div>
    </div>
    ${salary_range ? `
    <div class="preview-field">
      <div class="preview-label">üí∞ Salaire</div>
      <div class="preview-value">${salary_range}</div>
    </div>` : ''}
    <div class="preview-field">
      <div class="preview-label">üìù Description</div>
      <div class="preview-value">${description}</div>
    </div>
    ${requirements ? `
    <div class="preview-field">
      <div class="preview-label">‚úÖ Profil recherch√©</div>
      <div class="preview-value">${requirements}</div>
    </div>` : ''}
  `;

  document.getElementById("previewContent").innerHTML = previewHTML;
  document.getElementById("previewModal").classList.add("active");
}

function closePreview(){
  document.getElementById("previewModal").classList.remove("active");
}

/* =========================
   SUBMIT
========================= */
async function submitOffer(){
  const btnSubmit = document.getElementById("btnSubmit");
  const modal = document.getElementById("previewModal");

  // R√©cup√©ration
  const company_name = document.getElementById("company_name").value.trim();
  const recruiter_name = document.getElementById("recruiter_name").value.trim();
  const recruiter_phone = document.getElementById("recruiter_phone").value.trim();
  const recruiter_email = document.getElementById("recruiter_email").value.trim();
  const job_title = document.getElementById("job_title").value.trim();
  const job_type = document.getElementById("job_type").value;
  const location = document.getElementById("location").value.trim();
  const salary_range = document.getElementById("salary_range").value.trim();
  const description = document.getElementById("description").value.trim();
  const requirements = document.getElementById("requirements").value.trim();

  // Fermer modal
  modal.classList.remove("active");

  // D√©sactivation
  btnSubmit.disabled = true;
  btnSubmit.textContent = "üì§ Publication en cours...";

  try{
    const payload = {
      company_name,
      recruiter_name: recruiter_name || null,
      recruiter_phone,
      recruiter_email: recruiter_email || null,
      job_title,
      job_type,
      location,
      salary_range: salary_range || null,
      description,
      requirements: requirements || null,
      status: "pending"
    };

    const { error } = await SB
      .from("job_offers")
      .insert(payload);

    if(error){
      console.error("Erreur Supabase:", error);
      alert("‚ùå Erreur lors de la publication. R√©essayez.");
      btnSubmit.disabled = false;
      btnSubmit.textContent = "üëÅÔ∏è Pr√©visualiser l'offre";
      return;
    }

    // Supprimer brouillon
    deleteDraft();

    // Redirection vers page de confirmation
    localStorage.setItem("job_published", JSON.stringify({
      company: company_name,
      title: job_title,
      timestamp: Date.now()
    }));

    location.href = "jobs-confirmation.html";

  }catch(err){
    console.error("Erreur:", err);
    alert("‚ùå Une erreur est survenue. R√©essayez.");
    btnSubmit.disabled = false;
    btnSubmit.textContent = "üëÅÔ∏è Pr√©visualiser l'offre";
  }
}

/* =========================
   INIT
========================= */
window.addEventListener("load", () => {
  checkDraft();
  updateProgress();
});
</script>

</body>
</html>
